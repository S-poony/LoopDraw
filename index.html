<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Drawing Looper - Chrono Replay</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="style.css">
</head>

<body class="flex flex-col h-screen">

    <!-- Interface -->
    <div class="p-4 bg-zinc-900 border-b border-zinc-800 flex items-center justify-between z-20">
        <div class="flex items-center gap-6">
            <div>
                <h1 class="font-bold text-xl text-white">Drawing Looper</h1>
                <p class="text-xs text-zinc-500">Cycle: <span id="cycleCount" class="text-blue-400">1</span> | Color:
                    <span id="currentColorBox" class="inline-block w-3 h-3 rounded-full align-middle"></span>
                </p>
            </div>

            <div class="flex flex-col">
                <label class="text-[10px] uppercase text-zinc-500 font-bold">Cycle Duration</label>
                <div class="flex items-center gap-2">
                    <input type="range" id="durationSlider" min="5" max="60" value="30" class="w-24">
                    <span id="durationVal" class="text-sm font-mono">30s</span>
                </div>
            </div>
        </div>

        <div class="flex items-center gap-4">
            <!-- Tools -->
            <div class="flex items-center gap-2 bg-zinc-800 rounded-lg p-1">
                <button id="penBtn"
                    class="tool-btn active bg-zinc-700 hover:bg-zinc-600 text-white px-3 py-1.5 rounded text-sm flex items-center gap-2">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z" />
                    </svg>
                    Pen
                </button>
                <button id="eraserBtn"
                    class="tool-btn bg-zinc-800 hover:bg-zinc-700 text-zinc-300 hover:text-white px-3 py-1.5 rounded text-sm flex items-center gap-2">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path
                            d="m7 21-4.3-4.3c-1-1-1-2.5 0-3.4l9.6-9.6c1-1 2.5-1 3.4 0l5.6 5.6c1 1 1 2.5 0 3.4L13 21" />
                        <path d="M22 21H7" />
                        <path d="m5 11 9 9" />
                    </svg>
                    Eraser
                </button>
            </div>

            <!-- Onion Skin Toggle -->
            <button id="onionBtn"
                class="bg-zinc-800 hover:bg-zinc-700 text-zinc-300 hover:text-white px-3 py-2 rounded-lg text-sm transition-colors flex items-center gap-2">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path
                        d="M12 3a9 9 0 1 0 9 9c0-.46-.04-.92-.1-1.36a5.389 5.389 0 0 1-4.4 2.26 5.403 5.403 0 0 1-3.14-9.8c-.61-.13-1.24-.2-1.36-.1z" />
                </svg>
                <span id="onionText">Onion Skin: Off</span>
            </button>

            <!-- Export -->
            <button id="exportBtn"
                class="bg-blue-600 hover:bg-blue-500 text-white px-4 py-2 rounded-lg text-sm transition-colors flex items-center gap-2">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" />
                    <polyline points="7 10 12 15 17 10" />
                    <line x1="12" y1="15" x2="12" y2="3" />
                </svg>
                Export
            </button>

            <button id="clearBtn"
                class="bg-zinc-800 hover:bg-red-900 text-zinc-300 hover:text-white px-4 py-2 rounded-lg text-sm transition-colors">Clear
                All</button>
            <div class="flex flex-col items-end">
                <div class="w-48 h-3 bg-zinc-800 rounded-full overflow-hidden border border-zinc-700">
                    <div id="progressBar" class="h-full bg-blue-500 w-0 transition-all duration-100"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Drawing Area -->
    <div class="relative flex-grow bg-white overflow-hidden">
        <!-- Onion skin: STATIC snapshot of all previous cycles (fully drawn) -->
        <canvas id="onionCanvas" class="absolute top-0 left-0 w-full h-full pointer-events-none"
            style="opacity: 0; transition: opacity 0.3s;"></canvas>
        <!-- Replay of previous cycles (animated based on time) -->
        <canvas id="replayCanvas" class="absolute top-0 left-0 w-full h-full"></canvas>
        <!-- Active drawing -->
        <canvas id="activeCanvas" class="absolute top-0 left-0 w-full h-full"></canvas>
    </div>

    <!-- Export Modal -->
    <div id="exportModal" class="hidden fixed inset-0 z-50 flex items-center justify-center p-4">
        <div class="absolute inset-0 bg-black/60 backdrop-blur-sm" id="modalBackdrop"></div>
        <div class="relative bg-zinc-900 border border-zinc-800 rounded-xl shadow-2xl p-6 w-full max-w-md transform transition-all scale-95 opacity-0"
            id="modalContainer">
            <h2 class="text-xl font-bold text-white mb-2">Export Animation</h2>
            <p class="text-zinc-400 text-sm mb-6">Choose your preferred format for the capture of one full cycle.</p>

            <div class="space-y-3">
                <button id="exportPng"
                    class="w-full flex items-center justify-between p-4 bg-zinc-800 hover:bg-zinc-700 rounded-lg transition-colors group">
                    <div class="text-left">
                        <div class="text-white font-medium">Static Image</div>
                        <div class="text-zinc-500 text-xs">Current state as high-res PNG</div>
                    </div>
                    <svg class="text-zinc-600 group-hover:text-blue-400 transition-colors"
                        xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <rect x="3" y="3" width="18" height="18" rx="2" ry="2" />
                        <circle cx="8.5" cy="8.5" r="1.5" />
                        <polyline points="21 15 16 10 5 21" />
                    </svg>
                </button>

                <button id="exportVideo"
                    class="w-full flex items-center justify-between p-4 bg-zinc-800 hover:bg-zinc-700 rounded-lg transition-colors group">
                    <div class="text-left">
                        <div class="text-white font-medium">MP4 / WebM Video</div>
                        <div class="text-zinc-500 text-xs">Highest quality animation</div>
                    </div>
                    <svg class="text-zinc-600 group-hover:text-red-400 transition-colors"
                        xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <polygon points="23 7 16 12 23 17 23 7" />
                        <rect x="1" y="5" width="15" height="14" rx="2" ry="2" />
                    </svg>
                </button>
            </div>

            <div id="exportProgress" class="hidden mt-6 space-y-2">
                <div class="flex justify-between text-xs font-mono text-zinc-400">
                    <span id="progressText">Processing...</span>
                    <span id="progressPercent">0%</span>
                </div>
                <div class="h-1.5 bg-zinc-800 rounded-full overflow-hidden">
                    <div id="exportProgressBar" class="h-full bg-blue-500 w-0 transition-all duration-300"></div>
                </div>
            </div>

            <button id="closeModal"
                class="mt-6 w-full py-2 text-sm text-zinc-500 hover:text-white transition-colors">Cancel</button>
        </div>
    </div>

    <script src="app.js"></script>
</body>

</html>